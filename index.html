<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Side A</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#18120e;
  --panel:#2b2019;
  --panel-dark:#221912;
  --accent:#c58a2b;
  --label:#efe4d2;
  --text:#f3eee6;
}

*{margin:0;padding:0;box-sizing:border-box}
body{
  background:radial-gradient(circle at top,#2a1f18,#140f0c 70%);
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Inter,sans-serif;
  color:var(--text);
  overflow:hidden;
}

.screen{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  flex-direction:column;
  text-align:center;
  padding:40px;
  background:#140f0c;
}

.hidden{display:none}

button{
  background:var(--accent);
  border:none;
  padding:10px 20px;
  margin-top:20px;
  font-family:"IBM Plex Mono",monospace;
  cursor:pointer;
}

.cassette{
  width:min(420px,92vw);
  aspect-ratio:1.6/1;
  background:linear-gradient(145deg,var(--panel),var(--panel-dark));
  border-radius:18px;
  box-shadow:
    inset 0 3px 6px rgba(255,255,255,0.05),
    inset 0 -6px 12px rgba(0,0,0,0.6),
    0 30px 60px rgba(0,0,0,0.8);
  padding:28px;
  position:relative;
}

.label{
  background:var(--label);
  color:#1a140f;
  padding:8px 14px;
  font-family:"IBM Plex Mono",monospace;
  font-size:12px;
  border-radius:4px;
  margin-bottom:16px;
  letter-spacing:1px;
}

.window{
  background:#0f0b09;
  border-radius:12px;
  height:55%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:20px;
  position:relative;
}

.ribbon{
  position:absolute;
  height:3px;
  background:var(--accent);
  left:15%;
  right:15%;
  top:50%;
  transform:translateY(-50%);
  opacity:0.6;
}

.reel{
  width:90px;height:90px;
  border-radius:50%;
  border:2px solid var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
}

.teeth{
  width:70%;height:70%;
  border-radius:50%;
  border:6px dashed var(--accent);
}

.rotating{
  animation:spin linear infinite;
}

@keyframes spin{
  from{transform:rotate(0)}
  to{transform:rotate(360deg)}
}

.meta{
  margin-top:22px;
  text-align:center;
  font-size:15px;
  opacity:.9;
}

.controls{
  display:flex;
  gap:24px;
  margin-top:18px;
  justify-content:center;
}
</style>
</head>

<body>

<!-- INTRO -->
<div class="screen" id="intro">
  <div>This is something I made for you.</div>
  <button onclick="showTutorial()">Continue</button>
</div>

<!-- TUTORIAL -->
<div class="screen hidden" id="tutorial">
  <div style="max-width:400px">
    This is a digital cassette.<br><br>
    It plays from the first song to the last.<br>
    No skipping.<br>
    No shuffle.<br><br>
    Just sequence.<br><br>
    Press play and let it run.
  </div>
  <button onclick="startCassette()">Insert Tape</button>
</div>

<!-- CASSETTE -->
<div class="cassette hidden" id="cassette">

  <div class="label">SIDE A — FOR RIYA</div>

  <div class="window">
    <div class="reel" id="leftReel"><div class="teeth"></div></div>
    <div class="ribbon"></div>
    <div class="reel" id="rightReel"><div class="teeth"></div></div>
  </div>

  <div class="meta" id="trackMeta"></div>

  <div class="controls">
    <button onclick="togglePlay()" id="playBtn">PLAY</button>
    <button onclick="rewind()">REW</button>
  </div>
</div>

<audio id="currentAudio" preload="auto"></audio>
<audio id="nextAudio" preload="auto"></audio>
<audio id="hiss" src="sounds/hiss.mp3"></audio>

<script>
const CROSSFADE = 8;

const playlist = [
 {title:"we're fucked, it's fine",src:"songs/we're fucked, it's fine.mp3"},
 {title:"Stay Down",src:"songs/Stay Down.mp3"},
 {title:"Annie's Song",src:"songs/Annie's Song.mp3"},
 {title:"By Your Side",src:"songs/By Your Side.mp3"},
 {title:"Afterthought",src:"songs/Afterthought.mp3"},
 {title:"Kaleji",src:"songs/Kaleji.mp3"},
 {title:"Gravity",src:"songs/Gravity.mp3"},
 {title:"Slide",src:"songs/Slide.mp3"},
 {title:"Backseat",src:"songs/Backseat.mp3"},
 {title:"Maybe So",src:"songs/Maybe So.mp3"}
];

let index = 0;
let playing = false;
let fadeTimeout;

const current = document.getElementById("currentAudio");
const next = document.getElementById("nextAudio");
const playBtn = document.getElementById("playBtn");
const meta = document.getElementById("trackMeta");
const hiss = document.getElementById("hiss");
const leftReel = document.getElementById("leftReel");
const rightReel = document.getElementById("rightReel");

function showTutorial(){
  intro.classList.add("hidden");
  tutorial.classList.remove("hidden");
}

function startCassette(){
  tutorial.classList.add("hidden");
  cassette.classList.remove("hidden");
  loadTrack(index, current);
}

function loadTrack(i, audio){
  audio.src = encodeURI(playlist[i].src);
  audio.load();
  meta.textContent = "Track " + String(i+1).padStart(2,"0") + " — " + playlist[i].title;
}

function equalPowerFade(outgoing, incoming, duration){
  const start = performance.now();
  function frame(now){
    let t = (now - start) / (duration * 1000);
    if(t > 1) t = 1;
    outgoing.volume = Math.cos(t * 0.5 * Math.PI);
    incoming.volume = Math.cos((1 - t) * 0.5 * Math.PI);
    if(t < 1) requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

function scheduleNext(){
  if(index >= playlist.length - 1) return;

  const fadeTime = (current.duration - CROSSFADE) * 1000;

  fadeTimeout = setTimeout(()=>{
    index++;
    loadTrack(index, next);
    next.volume = 0;
    next.play();

    equalPowerFade(current, next, CROSSFADE);

    setTimeout(()=>{
      current.pause();
      current.currentTime = 0;
      current.volume = 1;
      [current.src, next.src] = [next.src, current.src];
      scheduleNext();
    }, CROSSFADE * 1000);

  }, fadeTime);
}

function togglePlay(){
  if(!playing){
    playing = true;
    playBtn.textContent = "PAUSE";
    hiss.play();
    leftReel.classList.add("rotating");
    rightReel.classList.add("rotating");
    current.play();
    current.onloadedmetadata = scheduleNext;
  } else {
    playing = false;
    playBtn.textContent = "PLAY";
    current.pause();
    clearTimeout(fadeTimeout);
    leftReel.classList.remove("rotating");
    rightReel.classList.remove("rotating");
  }
}

function rewind(){
  playing = false;
  clearTimeout(fadeTimeout);
  index = 0;
  current.pause();
  current.currentTime = 0;
  current.volume = 1;
  loadTrack(index, current);
  playBtn.textContent = "PLAY";
}
</script>

</body>
</html>