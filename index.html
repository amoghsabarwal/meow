<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MEOW</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

<style>
:root{
  --bg:#1a1410;
  --cassette:#2a211b;
  --cassette-dark:#201914;
  --accent:#c58a2b;
  --label:#efe4d2;
  --text:#f3eee6;
}

*{margin:0;padding:0;box-sizing:border-box}

body{
  background:radial-gradient(circle at top,#2a1f18,#140f0c 70%);
  height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
  font-family:Inter,sans-serif;
  color:var(--text);
}

.intro{
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:#140f0c;
  z-index:10;
  cursor:pointer;
  text-align:center;
  font-size:14px;
  letter-spacing:1px;
  font-family:"IBM Plex Mono",monospace;
}

.hidden{display:none}

.cassette{
  width:min(420px,92vw);
  aspect-ratio:1.6/1;
  background:linear-gradient(145deg,var(--cassette),var(--cassette-dark));
  border-radius:16px;
  box-shadow:
    inset 0 2px 4px rgba(255,255,255,0.05),
    inset 0 -4px 10px rgba(0,0,0,0.6),
    0 25px 60px rgba(0,0,0,0.7);
  padding:30px;
  position:relative;
}

.label{
  background:var(--label);
  color:#1a140f;
  padding:8px 12px;
  font-family:"IBM Plex Mono",monospace;
  font-size:12px;
  letter-spacing:1px;
  width:max-content;
  border-radius:4px;
  margin-bottom:14px;
}

.window{
  background:#0f0b09;
  border-radius:10px;
  height:55%;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:20px;
  position:relative;
}

.ribbon{
  position:absolute;
  height:3px;
  background:var(--accent);
  left:15%;
  right:15%;
  top:50%;
  transform:translateY(-50%);
  opacity:0.6;
}

.reel{
  width:90px;height:90px;
  border-radius:50%;
  border:2px solid var(--accent);
  display:flex;
  align-items:center;
  justify-content:center;
}

.teeth{
  width:70%;height:70%;
  border-radius:50%;
  border:6px dashed var(--accent);
}

.rotating{
  animation:spin 3s linear infinite;
}

@keyframes spin{
  from{transform:rotate(0)}
  to{transform:rotate(360deg)}
}

.controls{
  display:flex;
  gap:24px;
  margin-top:24px;
  justify-content:center;
}

.btn{
  background:#1b1612;
  border:none;
  color:var(--accent);
  font-family:"IBM Plex Mono",monospace;
  padding:8px 16px;
  border-radius:20px;
  cursor:pointer;
}

.meta{
  margin-top:24px;
  font-size:16px;
  opacity:.8;
  text-align:center;
}
</style>
</head>

<body>

<div class="intro" id="intro">
  This is something I made for you.<br><br>
  Tap to insert tape.
</div>

<div class="cassette hidden" id="cassette">

  <div class="label">SIDE A — FOR RIYA</div>

  <div class="window">
    <div class="reel" id="leftReel"><div class="teeth"></div></div>
    <div class="ribbon"></div>
    <div class="reel" id="rightReel"><div class="teeth"></div></div>
  </div>

  <div class="meta" id="trackMeta"></div>

  <div class="controls">
    <button class="btn" id="playBtn">PLAY</button>
    <button class="btn" id="rewBtn">REW</button>
  </div>
</div>

<audio id="audioA" preload="auto"></audio>
<audio id="audioB" preload="auto"></audio>
<audio id="hiss" src="sounds/hiss.mp3"></audio>

<script>
const CROSSFADE = 8;

const playlist = [
 {title:"we're fucked, it's fine",src:"songs/we're fucked, it's fine.mp3"},
 {title:"Stay Down",src:"songs/Stay Down.mp3"},
 {title:"Annie's Song",src:"songs/Annie's Song.mp3"},
 {title:"By Your Side",src:"songs/By Your Side.mp3"},
 {title:"Afterthought",src:"songs/Afterthought.mp3"},
 {title:"Kaleji",src:"songs/Kaleji.mp3"},
 {title:"Gravity",src:"songs/Gravity.mp3"},
 {title:"Slide",src:"songs/Slide.mp3"},
 {title:"Backseat",src:"songs/Backseat.mp3"},
 {title:"Maybe So",src:"songs/Maybe So.mp3"}
];

let index = 0;
let isPlaying = false;
let crossfadeStarted = false;
let monitor = null;

const audioA = document.getElementById("audioA");
const audioB = document.getElementById("audioB");
let current = audioA;
let next = audioB;

const playBtn = document.getElementById("playBtn");
const rewBtn = document.getElementById("rewBtn");
const meta = document.getElementById("trackMeta");
const hiss = document.getElementById("hiss");
const leftReel = document.getElementById("leftReel");
const rightReel = document.getElementById("rightReel");

document.getElementById("intro").onclick = () => {
  document.getElementById("intro").classList.add("hidden");
  document.getElementById("cassette").classList.remove("hidden");
};

function loadTrack(i, audio){
  audio.src = encodeURI(playlist[i].src);
  audio.load();
  meta.textContent = "Track " + String(i+1).padStart(2,"0") + " — " + playlist[i].title;
}

function equalPowerFade(outgoing, incoming, duration){
  const start = performance.now();
  function frame(now){
    let t = (now - start) / (duration * 1000);
    if(t > 1) t = 1;
    outgoing.volume = Math.cos(t * 0.5 * Math.PI);
    incoming.volume = Math.cos((1 - t) * 0.5 * Math.PI);
    if(t < 1) requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
}

function startMonitor(){
  monitor = setInterval(() => {
    if(!current.duration || isNaN(current.duration)) return;

    const timeLeft = current.duration - current.currentTime;

    if(timeLeft <= CROSSFADE && !crossfadeStarted && index < playlist.length - 1){
      crossfadeStarted = true;
      index++;

      loadTrack(index, next);
      next.volume = 0;

      next.onloadedmetadata = () => {
        next.play();
        equalPowerFade(current, next, CROSSFADE);

        setTimeout(() => {
          current.pause();
          current.currentTime = 0;
          current.volume = 1;
          [current, next] = [next, current];
          crossfadeStarted = false;
        }, CROSSFADE * 1000);
      };
    }

    if(index === playlist.length - 1 && current.ended){
      pause();
      meta.textContent = "Side A Complete";
      clearInterval(monitor);
    }

  }, 200);
}

function play(){
  isPlaying = true;
  playBtn.textContent = "PAUSE";
  hiss.play();
  leftReel.classList.add("rotating");
  rightReel.classList.add("rotating");
  current.play();
  startMonitor();
}

function pause(){
  isPlaying = false;
  playBtn.textContent = "PLAY";
  current.pause();
  leftReel.classList.remove("rotating");
  rightReel.classList.remove("rotating");
  clearInterval(monitor);
}

function rewind(){
  pause();
  index = 0;
  current.pause();
  next.pause();
  current.currentTime = 0;
  current.volume = 1;
  loadTrack(index, current);
}

playBtn.onclick = () => isPlaying ? pause() : play();
rewBtn.onclick = rewind;

loadTrack(index, current);
</script>

</body>
</html>